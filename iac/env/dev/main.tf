# main.tf
module "dev" {
  source                                              = "../../modules/video_env"
  app                                                 = var.app
  aws_profile                                         = var.aws_profile
  internal                                            = var.internal
  kpl_port                                            = var.kpl_port
  log_level                                           = var.log_level
  saml_role                                           = var.saml_role
  container_port_app                                  = var.container_port_app
  health_check_app                                    = var.health_check_app
  firehose_raw_buffer_size                            = var.firehose_raw_buffer_size
  firehose_raw_buffer_interval                        = var.firehose_raw_buffer_interval
  firehose_agg_buffer_size                            = var.firehose_agg_buffer_size
  firehose_agg_buffer_interval                        = var.firehose_agg_buffer_interval
  firehose_late_buffer_size                           = var.firehose_late_buffer_size
  firehose_late_buffer_interval                       = var.firehose_late_buffer_interval
  firehose_sess_buffer_size                           = var.firehose_sess_buffer_size
  firehose_sess_buffer_interval                       = var.firehose_sess_buffer_interval
  deregistration_delay                                = var.deregistration_delay
  tags                                                = var.tags
  hosted_zone                                         = var.hosted_zone
  common_subdomain                                    = var.common_subdomain
  common_environment                                  = var.common_environment
  destination_region                                  = var.destination_region
  source_region                                       = var.source_region
  stream_position_raw                                 = var.stream_position_raw
  kda_agg_jar_name                                    = var.kda_agg_jar_name
  timestream_ingest_batch_size                        = var.timestream_ingest_batch_size
  shard_use_adaptive_reads                            = var.shard_use_adaptive_reads
  shard_getrecords_interval_millis                    = var.shard_getrecords_interval_millis
  shard_getrecords_max                                = var.shard_getrecords_max
  kda_use_efo                                         = var.kda_use_efo
  ecs_as_cpu_high_threshold_per                       = var.ecs_as_cpu_high_threshold_per
  num_of_containers_to_add_during_scaling             = var.num_of_containers_to_add_during_scaling
  num_of_containers_to_remove_during_scaledown        = var.num_of_containers_to_remove_during_scaledown
  detailed_shard_level_metrics                        = var.detailed_shard_level_metrics
  timestream_magnetic_ret_pd_in_days                  = var.timestream_magnetic_ret_pd_in_days
  timestream_memory_ret_pd_in_hours                   = var.timestream_memory_ret_pd_in_hours
  late_arriving_secs                                  = var.late_arriving_secs
  video_session_ttl_secs                              = var.video_session_ttl_secs
  snowflake_iam_user                                  = var.snowflake_iam_user
  payload_display_on_error                            = var.payload_display_on_error
  payload_limit                                       = var.payload_limit
  enable_encryption                                   = var.enable_encryption
  ecs_autoscale_min_instances_loader                  = var.ecs_autoscale_min_instances_loader
  test_without_kpl                                    = var.test_without_kpl
  state_ttl_secs                                      = var.state_ttl_secs
  batch_size                                          = var.batch_size
  maximum_batching_window_in_seconds                  = var.maximum_batching_window_in_seconds
  starting_position                                   = var.starting_position
  maximum_retry_attempts                              = var.maximum_retry_attempts
  maximum_record_age_in_seconds                       = var.maximum_record_age_in_seconds
  bisect_batch_on_function_error                      = var.bisect_batch_on_function_error
  parallelization_factor                              = var.parallelization_factor
  environment_us_east_1                               = var.environment_us_east_1
  region_us_east_1                                    = var.region_us_east_1
  vpc_us_east_1                                       = var.vpc_us_east_1
  private_subnets_us_east_1                           = var.private_subnets_us_east_1
  public_subnets_us_east_1                            = var.public_subnets_us_east_1
  raw_target_bucket_name_us_east_1                    = var.raw_target_bucket_name_us_east_1
  agg_target_bucket_name_us_east_1                    = var.agg_target_bucket_name_us_east_1
  late_target_bucket_name_us_east_1                   = var.late_target_bucket_name_us_east_1
  sess_target_bucket_name_us_east_1                   = var.sess_target_bucket_name_us_east_1
  ecs_autoscale_min_instances_app_us_east_1           = var.ecs_autoscale_min_instances_app_us_east_1
  ecs_autoscale_max_instances_app_us_east_1           = var.ecs_autoscale_max_instances_app_us_east_1
  kds_raw_shard_count_us_east_1                       = var.kds_raw_shard_count_us_east_1
  kds_agg_shard_count_us_east_1                       = var.kds_agg_shard_count_us_east_1
  kds_late_shard_count_us_east_1                      = var.kds_late_shard_count_us_east_1
  kds_sess_shard_count_us_east_1                      = var.kds_sess_shard_count_us_east_1
  kda_agg_parallelism_us_east_1                       = var.kda_agg_parallelism_us_east_1
  kda_agg_parallelism_per_kpu_us_east_1               = var.kda_agg_parallelism_per_kpu_us_east_1
  ecs_task_kpl_east_env                               = var.ecs_task_kpl_east_env
  ecs_task_kpl_dmt_east_env                           = var.ecs_task_kpl_dmt_east_env
  ecs_task_kpl_slpd_east_env                          = var.ecs_task_kpl_slpd_east_env
  east_loader_role_arn                                = var.east_loader_role_arn
  east_ecr_loader_arn                                 = var.east_ecr_loader_arn
  east_ecr_loader_ltpd_arn                            = var.east_ecr_loader_ltpd_arn
  east_ecr_reader_ltpd_arn                            = var.east_ecr_reader_ltpd_arn
  kda-records-out-per-sec-agg-enabled                 = var.kda-records-out-per-sec-agg-enabled
  kda-millis-behind-latest-agg-enabled                = var.kda-millis-behind-latest-agg-enabled
  kda-last-checkpoint-dur-agg-enabled                 = var.kda-last-checkpoint-dur-agg-enabled
  kda-last-checkpoint-size-agg-enabled                = var.kda-last-checkpoint-size-agg-enabled
  too_many_requests_threshold_us_east_1               = var.too_many_requests_threshold_us_east_1
  too_many_5xx_response_threshold_us_east_1           = var.too_many_5xx_response_threshold_us_east_1
  high_response_time_threshold_us_east_1              = var.high_response_time_threshold_us_east_1
  high_running_task_count_threshold_us_east_1         = var.high_running_task_count_threshold_us_east_1
  high_cpu_utilization_threshold_us_east_1            = var.high_cpu_utilization_threshold_us_east_1
  high_memory_utilization_threshold_us_east_1         = var.high_memory_utilization_threshold_us_east_1
  high_raw_kds_putrecs_failedrecs_threshold_us_east_1 = var.high_raw_kds_putrecs_failedrecs_threshold_us_east_1
  high_agg_kds_putrecs_failedrecs_threshold_us_east_1 = var.high_agg_kds_putrecs_failedrecs_threshold_us_east_1
  high_raw_kpl_retries_threshold_us_east_1            = var.high_raw_kpl_retries_threshold_us_east_1
  high_agg_kpl_retries_threshold_us_east_1            = var.high_agg_kpl_retries_threshold_us_east_1
  kda_records_out_per_sec_agg_threshold_us_east_1     = var.kda_records_out_per_sec_agg_threshold_us_east_1
  kda_millis_behind_latest_agg_threshold_us_east_1    = var.kda_millis_behind_latest_agg_threshold_us_east_1
  kda_last_checkpoint_dur_agg_threshold_us_east_1     = var.kda_last_checkpoint_dur_agg_threshold_us_east_1
  kda_last_checkpoint_size_agg_threshold_us_east_1    = var.kda_last_checkpoint_size_agg_threshold_us_east_1
  kda_heap_memory_util_agg_threshold_us_east_1        = var.kda_heap_memory_util_agg_threshold_us_east_1
  kda_cpu_util_agg_threshold_us_east_1                = var.kda_cpu_util_agg_threshold_us_east_1
  kda_threads_count_agg_threshold_us_east_1           = var.kda_threads_count_agg_threshold_us_east_1
  kda_max_exp_gc_time_agg_threshold_us_east_1         = var.kda_max_exp_gc_time_agg_threshold_us_east_1
  kda_max_exp_gc_cnt_agg_threshold_us_east_1          = var.kda_max_exp_gc_cnt_agg_threshold_us_east_1
  kda_min_exp_water_agg_threshold_us_east_1           = var.kda_min_exp_water_agg_threshold_us_east_1
  timestream_system_err_threshold_us_east_1           = var.timestream_system_err_threshold_us_east_1
  timestream_user_err_threshold_us_east_1             = var.timestream_user_err_threshold_us_east_1
  timestream_tbl_suc_req_latency_threshold_us_east_1  = var.timestream_tbl_suc_req_latency_threshold_us_east_1
  timestream_buf_error_threshold_us_east_1            = var.timestream_buf_error_threshold_us_east_1
  environment_us_west_2                               = var.environment_us_west_2
  region_us_west_2                                    = var.region_us_west_2
  vpc_us_west_2                                       = var.vpc_us_west_2
  private_subnets_us_west_2                           = var.private_subnets_us_west_2
  public_subnets_us_west_2                            = var.public_subnets_us_west_2
  raw_target_bucket_name_us_west_2                    = var.raw_target_bucket_name_us_west_2
  agg_target_bucket_name_us_west_2                    = var.agg_target_bucket_name_us_west_2
  late_target_bucket_name_us_west_2                   = var.late_target_bucket_name_us_west_2
  sess_target_bucket_name_us_west_2                   = var.sess_target_bucket_name_us_west_2
  ecs_autoscale_min_instances_app_us_west_2           = var.ecs_autoscale_min_instances_app_us_west_2
  ecs_autoscale_max_instances_app_us_west_2           = var.ecs_autoscale_max_instances_app_us_west_2
  kds_raw_shard_count_us_west_2                       = var.kds_raw_shard_count_us_west_2
  kds_agg_shard_count_us_west_2                       = var.kds_agg_shard_count_us_west_2
  kds_late_shard_count_us_west_2                      = var.kds_late_shard_count_us_west_2
  kds_sess_shard_count_us_west_2                      = var.kds_sess_shard_count_us_west_2
  kda_agg_parallelism_us_west_2                       = var.kda_agg_parallelism_us_west_2
  kda_agg_parallelism_per_kpu_us_west_2               = var.kda_agg_parallelism_per_kpu_us_west_2
  ecs_task_kpl_west_env                               = var.ecs_task_kpl_west_env
  west_loader_role_arn                                = var.west_loader_role_arn
  west_ecr_loader_arn                                 = var.west_ecr_loader_arn
  west_ecr_loader_ltpd_arn                            = var.west_ecr_loader_ltpd_arn
  west_ecr_reader_ltpd_arn                            = var.west_ecr_reader_ltpd_arn
  too_many_requests_threshold_us_west_2               = var.too_many_requests_threshold_us_west_2
  too_many_5xx_response_threshold_us_west_2           = var.too_many_5xx_response_threshold_us_west_2
  high_response_time_threshold_us_west_2              = var.high_response_time_threshold_us_west_2
  high_running_task_count_threshold_us_west_2         = var.high_running_task_count_threshold_us_west_2
  high_cpu_utilization_threshold_us_west_2            = var.high_cpu_utilization_threshold_us_west_2
  high_memory_utilization_threshold_us_west_2         = var.high_memory_utilization_threshold_us_west_2
  high_raw_kds_putrecs_failedrecs_threshold_us_west_2 = var.high_raw_kds_putrecs_failedrecs_threshold_us_west_2
  high_agg_kds_putrecs_failedrecs_threshold_us_west_2 = var.high_agg_kds_putrecs_failedrecs_threshold_us_west_2
  high_raw_kpl_retries_threshold_us_west_2            = var.high_raw_kpl_retries_threshold_us_west_2
  high_agg_kpl_retries_threshold_us_west_2            = var.high_agg_kpl_retries_threshold_us_west_2
  kda_records_out_per_sec_agg_threshold_us_west_2     = var.kda_records_out_per_sec_agg_threshold_us_west_2
  kda_millis_behind_latest_agg_threshold_us_west_2    = var.kda_millis_behind_latest_agg_threshold_us_west_2
  kda_last_checkpoint_dur_agg_threshold_us_west_2     = var.kda_last_checkpoint_dur_agg_threshold_us_west_2
  kda_last_checkpoint_size_agg_threshold_us_west_2    = var.kda_last_checkpoint_size_agg_threshold_us_west_2
  kda_heap_memory_util_agg_threshold_us_west_2        = var.kda_heap_memory_util_agg_threshold_us_west_2
  kda_cpu_util_agg_threshold_us_west_2                = var.kda_cpu_util_agg_threshold_us_west_2
  kda_threads_count_agg_threshold_us_west_2           = var.kda_threads_count_agg_threshold_us_west_2
  kda_max_exp_gc_time_agg_threshold_us_west_2         = var.kda_max_exp_gc_time_agg_threshold_us_west_2
  kda_max_exp_gc_cnt_agg_threshold_us_west_2          = var.kda_max_exp_gc_cnt_agg_threshold_us_west_2
  kda_min_exp_water_agg_threshold_us_west_2           = var.kda_min_exp_water_agg_threshold_us_west_2
  timestream_system_err_threshold_us_west_2           = var.timestream_system_err_threshold_us_west_2
  timestream_user_err_threshold_us_west_2             = var.timestream_user_err_threshold_us_west_2
  timestream_tbl_suc_req_latency_threshold_us_west_2  = var.timestream_tbl_suc_req_latency_threshold_us_west_2
  timestream_buf_error_threshold_us_west_2            = var.timestream_buf_error_threshold_us_west_2
  kda_bucket_kms_arn_us_east_1                        = var.kda_bucket_kms_arn_us_east_1
  kda_bucket_kms_arn_us_west_2                        = var.kda_bucket_kms_arn_us_west_2
  lambda_bucket_kms_arn_us_east_1                     = var.lambda_bucket_kms_arn_us_east_1
  lambda_bucket_kms_arn_us_west_2                     = var.lambda_bucket_kms_arn_us_west_2
}
terraform {
  backend "s3" {
    region  = "us-east-1"
    profile = ""
    bucket  = "tf-state-doppler-video"
    key     = "dev.terraform.tfstate"
  }
}

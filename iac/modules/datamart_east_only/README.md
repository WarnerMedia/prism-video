# datamart_east_only

## Function

- Creates the cloudwatch dashboard, and cloudwatch alarms. This was created as a module because I needed a way to isolate one time global tasks. We only can have one route 53 record for all regions. We can only have one global accelerator for all regions. I think its best practice to have one Cloudwatch Dashboard and one place where we create all the Cloudwatch alarms.

## Contains the following terraform files

dashboard.tf - creates cloudwatch dashboard for all regions supported; this is at this module level due to the desire to have one dashboard for all suppoerted regions  
main.tf - main entrypoint into module  
provider.tf - this contains the providers for each stack. Currently has only us-east-1.  
variables.tf - variables needed by this module.  
versions.tf - controls versioning of terraform resources

## Variables

| Name                                      | Description                                                                                                                                                                                                                                                                                                                 |       Type        |   Default   | Required |
| ----------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------: | :---------: | :------: |
| app                                       | Name of the application. This value should usually match the application tag below.                                                                                                                                                                                                                                         |      string       |             |   yes    |
| aws_profile                               | The AWS profile to use, this would be the same value used in AWS_PROFILE.                                                                                                                                                                                                                                                   |      string       |             |   yes    |
| saml_role                                 | The role that will have access to the S3 bucket, this should be a role that all members of the team have access to.                                                                                                                                                                                                         |      string       |             |   yes    |
| tags                                      | A map of the tags to apply to various resources. The required tags are: <br>+ `application`, name of the app <br>+ `environment`, the environment being created <br>+ `team`, team responsible for the application <br>+ `contact-email`, contact email for the _team_ <br>+ `customer`, who the application was create for |        map        |   `<map>`   |   yes    |
| internal                                  | Whether the application load balancers use private or public subnets.                                                                                                                                                                                                                                                       |       bool        |    true     |   yes    |
| kpl_port                                  | The port the api will communicate with the kpl on.                                                                                                                                                                                                                                                                          |        int        |             |   yes    |
| log_level                                 | The verbosity of the logging. debug, info, none                                                                                                                                                                                                                                                                             |      string       |             |   yes    |
| deregistration_delay                      | Elastic Load Balancing stops sending requests to targets that are deregistering. By default, Elastic Load Balancing waits 300 seconds before completing the deregistration process, which can help in-flight requests to the target to complete                                                                             |      string       |             |   yes    |
| common_environment                        | The common environment name(i.e. dev, test, prod, etc)                                                                                                                                                                                                                                                                      |      string       |             |   yes    |
| vpc_us_east_1                             | The VPC to use for the Fargate cluster in us east 1                                                                                                                                                                                                                                                                         |      string       |             |   yes    |
| private_subnets_us_east_1                 | The private subnets, minimum of 2, that are a part of the VPC(s)                                                                                                                                                                                                                                                            |      string       |             |   yes    |
| public_subnets_us_east_1                  | The public subnets, minimum of 2, that are a part of the VPC(s)                                                                                                                                                                                                                                                             |      string       |             |   yes    |
| region_us_east_1                          | The AWS region to use for the environment's infrastructure.                                                                                                                                                                                                                                                                 |      string       | `us-east-1` |   yes    |
| environment_us_east_1                     | The destination environment prefix used in naming resource in the east                                                                                                                                                                                                                                                      |      string       |             |   yes    |
| target_bucket_name_us_east_1              | The target bucket name for the raw and agg data in us-east-1                                                                                                                                                                                                                                                                |      string       |             |   yes    |
| hosted_zone                               | The root domain name(i.e. doppler.com)                                                                                                                                                                                                                                                                                      |      string       |             |   yes    |
| container_name_app                        | The name of the api container                                                                                                                                                                                                                                                                                               |      string       |     app     |   yes    |
| container_port_app                        | The port the api listens on                                                                                                                                                                                                                                                                                                 |      string       |             |   yes    |
| health_check_app                          | The route to the api health check(i.e. /health)                                                                                                                                                                                                                                                                             |      string       |             |   yes    |
| ecs_autoscale_min_instances_app_us_east_1 | The minimum and desired # of api containers to run in us-east-1                                                                                                                                                                                                                                                             |        int        |      1      |   yes    |
| ecs_autoscale_max_instances_app_us_east_1 | The maximum # of api containers to run in us-east-1                                                                                                                                                                                                                                                                         |        int        |      5      |   yes    |
| kds_agg_shard_count_us_east_1             | The aggregation kinesis data streams shard count in us-east-1                                                                                                                                                                                                                                                               |        int        |      1      |   yes    |
| firehose_agg_buffer_size                  | The aggregation firehose buffer size                                                                                                                                                                                                                                                                                        |        int        |             |   yes    |
| firehose_agg_buffer_interval              | The aggregation firehose buffer interval                                                                                                                                                                                                                                                                                    |        int        |             |   yes    |
| kds_raw_shard_count_us_east_1             | The raw kinesis data streams shard count in us-east-1                                                                                                                                                                                                                                                                       |        int        |             |   yes    |
| firehose_raw_buffer_size                  | The raw firehose buffer size                                                                                                                                                                                                                                                                                                |        int        |             |   yes    |
| firehose_raw_buffer_interval              | The raw firehose buffer interval                                                                                                                                                                                                                                                                                            |        int        |             |   yes    |
| kda_agg_parallelism_us_east_1             | The agg KDA flink jobs parallelism in us-east-1                                                                                                                                                                                                                                                                             |        int        |             |   yes    |
| kda_agg_parallelism_per_kpu_us_east_1     | The agg KDA flink jobs parallelism per kpu in us-east-1                                                                                                                                                                                                                                                                     |        int        |             |   yes    |
| stream_position_raw                       | The starting stream position for the agg KDA Flink job                                                                                                                                                                                                                                                                      |      string       |             |   yes    |
| ecs_task_kpl_east_env                     | Hardcoded environment variables for kpl sidecars for us-east-1 \*\*NEEDS WORK                                                                                                                                                                                                                                               | list(map(string)) |             |   yes    |
